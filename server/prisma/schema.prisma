generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String   @db.VarChar(20)
  password  String   @db.VarChar(100)
  createdAt DateTime @default(now())

  companyId Int
  company   Company @relation(fields: [companyId], references: [id])


  // NEW: opposite relation fields for Task.assignedBy / Task.assignee
  tasksAssignedBy  Task[]         @relation("TaskAssignedBy") // tasks this user assigned
  tasksAssignedTo  Task[]         @relation("TaskAssignee") // tasks assigned to this user
  createdCompanies Company[]      @relation("CreatedCompanies") // tasks assigned to this user
  refreshTokens    RefreshToken[]
  projects         Project[]
  @@index([companyId])
}

model Company {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(20)
  about     String   @db.VarChar(100)
  createdAt DateTime @default(now())
  creatorId Int
  creator   User     @relation("CreatedCompanies", fields: [creatorId], references: [id])
  members   User[]
  projects  Project[]
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  tokenHash String
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  expiresAt DateTime

  @@index([userId])
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String   @db.VarChar(255)
  createdAt   DateTime @default(now())

  company     Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   Int

  creatorId Int?
  creator   User? @relation(fields: [creatorId], references: [id])

  tasks Task[]

  lists  List[]

  @@index([creatorId])
}
model List {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  projectId   Int
  createdAt   DateTime @default(now())
  project     Project @relation(fields:[projectId] , references:[id])

  tasks       Task[]
}

model Task {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String   @db.VarChar(255)
  createdAt   DateTime @default(now())

  priority Priority  @default(MEDIUM)
  dueDate  DateTime?

  parentTaskId Int?
  parentTask   Task?  @relation("TaskSubTasks", fields: [parentTaskId], references: [id], onDelete: Cascade)
  subTasks     Task[] @relation("TaskSubTasks")

  projectId Int
  project   Project @relation(fields: [projectId], references: [id])

  listId    Int
  list      List    @relation(fields: [listId] , references: [id])

  // Use matching relation names
  assignedById Int?
  assignedBy   User? @relation("TaskAssignedBy", fields: [assignedById], references: [id])

  assigneeId Int?
  assignee   User? @relation("TaskAssignee", fields: [assigneeId], references: [id])

  @@index([projectId])
  @@index([parentTaskId])
  @@index([assignedById])
  @@index([assigneeId])
}
